#Configurable:

CXX?=g++
AR?=ar

X10LIB?=../../pgas/common/work
CXXFLAGS+=-g
INCLUDE_DIRS+=-I$(X10LIB)/include -I.
ifdef ENABLE_GC
CXXFLAGS+=-DX10_USE_BDWGC
INCLUDE_DIRS+=-Ibdwgc/install/include
endif
CXXFLAGS+=$(INCLUDE_DIRS)
ifneq ($(wildcard /usr/include/lapi.h),) # AIX
CXX = mpCC_r
override CXXFLAGS -= -g
override CXXFLAGS -= -ansi -pedantic -Wall -Wextra -Wno-long-long -pthread
override CXXFLAGS += -q64
override CXXFLAGS += -O3 -qinline -qarch=pwr5 -qtune=pwr5 -qhot
override CXXFLAGS += -qrtti=all -DNDEBUG
# FIXME
ARFLAGS := -X64 $(ARFLAGS)
else
override CXXFLAGS += -ansi -pedantic -Wall -Wextra -Wno-long-long -pthread
endif


#Target:

ARCHIVE=libx10rt17.a

all: $(X10LIB)/include/x10/x10.h $(ARCHIVE) 

ALL_OBJECTS = \
	x10aux/assert.o \
	x10aux/async_switch.o \
	x10aux/boolean_utils.o \
	x10aux/bootstrap.o \
	x10aux/byte_utils.o \
	x10aux/char_utils.o \
	x10aux/double_utils.o \
	x10aux/int_utils.o \
	x10aux/init_dispatcher.o \
	x10aux/io/FILEPtrInputStream.o \
	x10aux/io/FILEPtrOutputStream.o \
	x10aux/io/FILEPtrStream.o \
	x10aux/float_utils.o \
	x10aux/long_utils.o \
	x10aux/math_utils.o \
	x10aux/pgas.o \
	x10aux/ref.o \
	x10aux/RTT.o \
	x10aux/rail_utils.o \
	x10aux/serialization.o \
	x10aux/short_utils.o \
	x10aux/string_utils.o \
	x10aux/system_utils.o \
	x10/io/EOFException.o \
	x10/io/FileInputStream.o \
	x10/io/FileOutputStream.o \
	x10/io/FileNotFoundException.o \
	x10/io/IOException.o \
	x10/io/NativeInputStream.o \
	x10/io/NativeOutputStream.o \
	x10/lang/ArrayIndexOutOfBoundsException.o \
	x10/lang/ClassCastException.o \
	x10/lang/Exception.o \
	x10/lang/VoidFun_0_0.o \
	x10/lang/NullPointerException.o \
	x10/lang/Object.o \
	x10/lang/Ref.o \
	x10/lang/RuntimeException.o \
	x10/lang/String.o \
	x10/lang/Throwable.o \
	x10/lang/Value.o \
	x10/runtime/InterruptedException.o \
	x10/runtime/Lock.o \
	x10/runtime/Thread.o 


$(ARCHIVE): $(ALL_OBJECTS)
	$(AR) $(ARFLAGS) $@ $^


#Standard stuff:

%.o: %.cc $(wildcard %.h)
	$(CXX) $(CXXFLAGS) -c $< -o $@

depend:
	find -name '*.cc' -o -name '*.h' | xargs makedepend -Y $(INCLUDE_DIRS) -f- > depend.mk 


clean:
	find -name '*.h.gch' -o -name '*.o' | xargs rm -vf
	rm -fv $(ARCHIVE)

squeakyclean: clean
	find -name '*~' -o -name '*.bak' | xargs rm -vf

.PHONY: all clean squeakyclean


#Optional file -- generated by makedepend (run "make depend").
-include depend.mk

# in this file we use hard tabs because they are semantically meaningful
# a width of 8 makes this difference more visible
# vim:tabstop=8:shiftwidth=8:noexpandtab
