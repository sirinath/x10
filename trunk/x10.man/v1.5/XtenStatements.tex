\chapter{Statements}\label{XtenStatements}\index{statements}

\section{Empty statement}

The empty statement \xcd";" does nothing.  It is useful when a
loop header is evaluated for its side effects.  For example,
the following code sums the elements of an array.
\begin{xten}
var sum: Int = 0;
for (i: Int = 0; i < a.length; i++, sum += a[i])
    ;
\end{xten}

\section{Expression statement}

The expression statement evaluates an expression, ignoring the
result.  The expression must be either an assignment, an
allocation, or a call.

\section{Labeled statement}

Statements may be labeled.  The label may be used as the target
of a break or continue statement.  The scope of a label is the
statement labeled.

\section{Break statement}

An unlabeled break statement exits the currently enclosing loop
or switch statement.

An labeled break statement exits the enclosing loop
or switch statement with the given label.

It is illegal to break out of a loop not defined in the current
method, constructor, initializer, or closure.

The following code searches for an element of a two-dimensional
array and breaks out of the loop when found:

\begin{xten}
var found: Boolean = false;
for (i: Int = 0; i < a.length; i++)
    for (j: Int = 0; j < a(i).length; j++)
        if (a(i)(j) == v) {
            found = true;
            break;
        }
\end{xten}

\section{Continue statement}

An unlabeled continue statement branches to the top of the
currently enclosing loop.

An labeled break statement branches to the top of the enclosing loop
with the given label.

It is illegal to continue a loop not defined in the current
method, constructor, initializer, or closure.

\section{If statement}

An if statement comes in two forms: with and without an else
clause.

The if-then statement evaluates a condition expression and 
evaluates the consequent expression if the condition is
\xcd"true".  If the 
condition is \xcd"false",
the if-then statement completes normally.

The if-then-else statement evaluates a condition expression and 
evaluates the consequent expression if the condition is
\xcd"true"; otherwise, the alternative statement is evaluated.

The condition must be of type \xcd"Boolean".

\section{Switch statement}

A switch statement evaluates an index expression and then branches to
a case whose value equal to the value of the index expression.
If no such case exists, the switch branches to the 
\xcd"default" case, if any.

Statements in each case branch evaluated in sequence.  At the
end of the branch, normal control-flow falls through to the next case, if
any.  To prevent fall-through, a case branch may be exited using a \xcd"break",
\xcd"continue", \xcd"return", or \xcd"throw" statement.

The index expression must be of type \xcd"Int".

Case labels must be of type \xcd"Int" and must be compile-time
constants.  Case labels cannot be duplicated within the
\xcd"switch" statement.

\section{While statement}

A while statement evaluates a condition and executes a loop body
if \xcd"true".  If the loop body completes normally (either by reaching
the end or via a \xcd"continue" statement with the loop header
as target), the condition is reevaluated and the loop repeats if
\xcd"true".  If the condition is \xcd"false", the loop
exits.

The condition must be of type \xcd"Boolean".

\section{Do--while statement}

A do-while statement executes a loop body, and then evaluates a
condition expression.  If \xcd"true", the loop repeats.
Otherwise, the loop exits.

The condition must be of type \xcd"Boolean".

\section{For statement}

A for statement consists of an initializer, a condition, an
iterator, and a body.  First, the initializer is evaluated.
The initializer may introduce local variables that are in scope
throughout the for statement.  An empty initializer is
permitted.
Next, the condition is evaluated.  If \xcd"true", the loop body
is executed; otherwise, the loop exits.
The condition may be omitted, in which case the condition is
considered \xcd"true".
If the loop completes normally (either by reaching the end
or via a \xcd"continue" statement with the loop header as
target),
the iterator is evaluated and then the condition is reevaluated
and the loop repeats if
\xcd"true".  If the condition is \xcd"false", the loop
exits.

The condition must be of type \xcd"Boolean".
The initializer and iterator are statements, not expressions
and so do not have types.

\section{Throw statement}

The \xcd"throw" statement throws an exception.  The exception
must be of type \xcd"x10.lang.Throwable".  If the exception is
\xcd"null", a \xcd"NullPointerException" is thrown.

\begin{example}
\begin{xten}
if (i < 0) 
    throw new IllegalArgumentException("Index " + i + " out of bounds.");
\end{xten}
\end{example}

\section{Try statement}

Exceptions are handled with a \xcd"try" statement.
A \xcd"try" statement consists of a \xcd"try" block, zero or more
\xcd"catch" blocks, and an optional \xcd"finally" block.

First, the \xcd"try" block is evaluated.  If the block throws an
exception, control transfers to the first matching \xcd"catch"
block, if any.  A \xcd"catch" matches if the value of the
exception thrown is a subclass of the \xcd"catch" block's formal
parameter type.

If the \xcd"try" block completes normally
or via a \xcd"return", a \xcd"break", or a
\xcd"continue" statement, 
the \xcd"finally"
block, if any, is evaluated, and then control flow resumes at
the end of the \xcd"try" statement, at the branch target, or at
the caller as appropriate.
If the \xcd"try" block completes
exceptionally, the \xcd"finally" block is evaluated (after any
matching \xcd"catch" block, if any), and then the
exception is rethrown.

\section{Assignment}\index{assignment}\label{AssignmentStatement}

%It is often the case that an \Xten{} variable is assigned to only
%once. The user may declare such variables as \xcd"final". However,
%this is sometimes syntactically cumbersome.
%
%{}\Xten{} supports the syntax \xcd"l := r" for assignment to mutable
%variables.  The user is strongly enouraged to use this syntax to
%assign variables that are intended to be assigned to more than
%once. The \Xten{} compiler may issue a warning if it detects code 
%that uses \xcd"=" assignment statements on \xcd"mutable" variables.

The assignment expression \xcd"x = e" assigns a value given by
expression \xcd"e"
to a mutable variable \xcd"x".  There are three forms of
assignment: \xcd"x" may be a local variable, it may be a field
\xcd"y.f", or it may be location given by the expression \xcd"a(i)".
In the last case, \xcd"a" must have a method \xcd"set" with the
following signature:
\begin{xten}
def set[S,T](i: S, v: T): T;
\end{xten}

\noindent where \xcd"S" and \xcd"T" are instantiated on the
types of \xcd"i" and \xcd"e", respectively.
The assignment \xcd"a(i) = e" is equivalent to the call
\xcd"a.set(i, e)".

For array variables, the right-hand-side
expression \xcd"e" 
must have the same distribution \xcd"a(i)". This
statement involves control communication between the sites hosting
\xcd"D". Each site performs the assignment(s) of array components
locally. The assignment terminates when assignment has terminated at
all sites hosting \xcd"D".

%% TODO: Sectional assignment??

%\input{rmi.tex}

\section{Iteration}\index{foreach@\xcd"foreach"}\label{ForLoop}
\index{for@\xcd"for"}\label{ForAllLoop}

We introduce $k$-dimensional versions of iteration operations \xcd"for" and 
\xcd"foreach":

\begin{grammar}
Statement \: ForStatement \\
ForStatement \: EnhancedForStatement \\
Statement \: ForEachStatement \\
EnhancedForStatement \: 
      \xcd"for" \xcd"(" FormalParameter \xcd"in" Expression \xcd")"
        Statement \\
ForEachStatement \: 
      \xcd"foreach" \xcd"(" FormalParameter \xcd"in" Expression \xcd")"
          Statement \\
\end{grammar}

In both statements, the expression is intended to be of type
\xcd"Region".  Expressions \xcd"e" of type \xcd"Dist" and
\xcd"array" are also accepted, and treated as if they were \xcd"e.region".
The compiler throws a type error in all other cases.

The formal parameter must be of type \xcd"point". Exploded syntax may
be used (\Sref{exploded-syntax}). The parameter is considered
implicitly final, as are all the exploded variables. 

An activity executes a \xcd"for" statement by enumerating the points
in the region in canonical order. The activity executes the body of
the loop with the formal parameter(s) bound to the given point. If the
body locally terminates successfully, the activity continues with the
next iteration, terminating successfully when all points have been
visited. If an iteration throws an exception then the for statement
throws an exception and terminats abruptly.

An activity executes a \xcd"foreach" statement in a similar fashion
except that separate \xcd"async" activities are launched in parallel
in the local place for each point in the region. The statement
terminates locally when all the activities have been spawned. It never
throws an exception, though exceptions thrown by the spawned
activities are propagated through to the root activity.

In a similar fashion we introduce the syntax:\index{ateach@\xcd"ateach"}

\begin{grammar}
Statement \: AtEachStatement \\
AtEachStatement \:
      \xcd"ateach" \xcd"(" FormalParameter \xcd"in" Expression \xcd")"
         Statement \\
\end{grammar}

Here the expression is intended to be of type \xcd"Dist".
Expressions \xcd"e" of type \xcd"array" are also accepted, and treated
as if they were \xcd"e.dist". The compiler throws a type error
in all other cases. This statement differs from \xcd"foreach" only in
that each activity is spawned at the place specified by the
distribution for the point. That is, 
\xcd"ateach(p(i1,...,ik): point in A) S" may
be thought of as standing for:
\begin{xten}
foreach (p(i1,...,ik): point in A) 
  async (A.dist(p)) {S}
\end{xten}

