#Configurable:

CXX?=g++
AR?=ar

X10LIB?=../../pgas/common/work
CXXFLAGS=-ansi -pedantic -Wall -Wextra
INCLUDE_DIRS+=-I$(X10LIB)/include -I.
CXXFLAGS+=$(INCLUDE_DIRS)
ifneq ($(wildcard /usr/include/lapi.h),) # AIX
CXX = mpCC_r
override CXXFLAGS -= -g
override CXXFLAGS += -q64
override CXXFLAGS += -O3 -qinline -qarch=pwr5 -qtune=pwr5 -qhot
override CXXFLAGS += -qrtti=all -DNDEBUG
# FIXME
ARFLAGS := -X64 $(ARFLAGS)
endif


#Target:

ARCHIVE=libx10rt17.a

all: $(X10LIB)/include/x10/x10.h $(ARCHIVE) 

ALL_OBJECTS = \
        x10aux/exit_code.o \
        x10aux/finish.o \
        x10aux/int_utils.o \
        x10aux/io/FILEPtrInputStream.o \
        x10aux/io/FILEPtrOutputStream.o \
        x10aux/io/FILEPtrStream.o \
        x10aux/place.o \
        x10aux/ref.o \
        x10aux/RTT.o \
        x10aux/runtime.o \
        x10aux/serialization.o \
        x10aux/string_utils.o \
        x10/io/FileNotFoundException.o \
        x10/io/IOException.o \
        x10/io/NativeInputStream.o \
        x10/io/NativeOutputStream.o \
        x10/lang/Exception.o \
        x10/lang/Object.o \
        x10/lang/Ref.o \
        x10/lang/String.o \
        x10/lang/Throwable.o \
        x10/lang/Value.o \

$(ARCHIVE): $(ALL_OBJECTS)
	$(AR) $(ARFLAGS) $@ $^


#Standard stuff:

%.o: %.cc $(wildcard %.h)
	$(CXX) $(CXXFLAGS) -c $< -o $@

depend:
	find -name '*.cc' -o -name '*.h' | xargs makedepend -Y $(INCLUDE_DIRS) -f- > depend.mk 


clean:
	find -name '*.h.gch' -o -name '*.o' | xargs rm -vf
	rm -fv $(ARCHIVE)

squeakyclean: clean
	find -name '*~' -o -name '*.bak' | xargs rm -vf

.PHONY: all clean squeakyclean


#Optional file -- generated by makedepend (run "make depend").
-include depend.mk

